var SimpleConsole=function(e){if(!e.handleCommand&&!e.outputOnly)throw new Error("You must specify either options.handleCommand(input) or options.outputOnly");var t=e.outputOnly,n=e.handleCommand,o=e.placeholder||"",i=(e.autofocus,e.storageID||"simple-console"),a=function(e,t,n,o="0 0 16 16"){var i=document.createElement("span");i.className=t,i.innerHTML='<svg width="1em" height="1em" viewBox="'+o+'">'+n+"</svg>",e.insertBefore(i,e.firstChild)},r=function(e){a(e,"input-chevron",'<path d="M6,4L10,8L6,12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>')},l=document.createElement("div");l.className="simple-console";var u=document.createElement("div");u.className="simple-console-output",u.setAttribute("role","log"),u.setAttribute("aria-live","polite");var s=document.createElement("div");s.className="simple-console-input-wrapper",r(s);var c,d=document.createElement("input");d.className="simple-console-input",d.setAttribute("autofocus","autofocus"),d.setAttribute("placeholder",o),d.setAttribute("aria-label",o),d.setAttribute("autocorrect","off"),d.setAttribute("autocapitalize","none"),l.appendChild(u),t||l.appendChild(s),s.appendChild(d);var p=function(e){var t=document.createElement("popup-menu");(t=document.createElement("div")).className="popup-menu",t.setAttribute("role","menu"),t.setAttribute("aria-hidden","true"),t.id="popup"+(~~(16777215*Math.random())).toString(16);var n=document.createElement("button");n.className="popup-button",n.setAttribute("aria-haspopup","true"),n.setAttribute("aria-owns",t.id),n.setAttribute("aria-expanded","false"),n.setAttribute("aria-label","Command history"),n.setAttribute("title","Command history"),a(n,"command-history-icon",'<path style="fill:currentColor" d="m 44.77595,87.58531 c -5.22521,-1.50964 -12.71218,-5.59862 -14.75245,-8.05699 -1.11544,-1.34403 -0.96175,-1.96515 1.00404,-4.05763 2.86639,-3.05114 3.32893,-3.0558 7.28918,-0.0735 18.67347,14.0622 46.68328,-0.57603 46.68328,-24.39719 0,-16.97629 -14.94179,-31.06679 -31.5,-29.70533 -14.50484,1.19263 -25.37729,11.25581 -28.04263,25.95533 l -0.67995,3.75 6.6362,0 6.6362,0 -7.98926,8 c -4.39409,4.4 -8.35335,8 -8.79836,8 -0.44502,0 -4.38801,-3.6 -8.7622,-8 l -7.95308,-8 6.11969,0 6.11969,0 1.09387,-6.20999 c 3.5237,-20.00438 20.82127,-33.32106 40.85235,-31.45053 11.43532,1.06785 21.61339,7.05858 27.85464,16.39502 13.06245,19.54044 5.89841,45.46362 -15.33792,55.50045 -7.49404,3.54188 -18.8573,4.55073 -26.47329,2.35036 z m 6.22405,-32.76106 c 0,-6.94142 0,-13.88283 0,-20.82425 2,0 4,0 6,0 0,6.01641 0,12.03283 0,18.04924 4.9478,2.93987 9.88614,5.89561 14.82688,8.84731 l -3.27407,4.64009 c -5.88622,-3.5132 -11.71924,-7.11293 -17.55281,-10.71239 z"/>',"0 0 102 102"),s.appendChild(n),s.appendChild(t),n.addEventListener("keydown",function(e){40===e.keyCode&&(e.preventDefault(),first_item=t.querySelector("[tabindex='0']"),first_item.focus())}),t.addEventListener("keydown",function(e){38===e.keyCode&&(first_item=t.querySelector("[tabindex='0']"),document.activeElement===first_item&&n.focus())},!0);var o=function(){n.setAttribute("aria-expanded","true"),t.setAttribute("aria-hidden","false"),c=n,e(t)},i=function(){n.setAttribute("aria-expanded","false"),t.setAttribute("aria-hidden","true"),c=null},r=function(){return"true"==n.getAttribute("aria-expanded")},l=function(){r()?i():o()};return n.addEventListener("click",l),addEventListener("mousedown",function(e){r()&&e.target.closest(".popup-button")!=n&&e.target.closest(".popup-menu")!=t&&i()}),addEventListener("focusin",function(e){r()&&e.target.closest(".popup-button")!=n&&e.target.closest(".popup-menu")!=t&&(e.preventDefault(),i())}),n.popup=t,n.openPopup=o,n.closePopup=i,n.togglePopup=l,n.popupIsOpen=r,n},m=function(e){var t=p(function(t){t.innerHTML="";for(var n=e(),o=0;o<n.length;o++){var i=n[o];if("divider"===i.type){var a=document.createElement("hr");a.classList.add("menu-divider"),t.appendChild(a)}else{var r=document.createElement("div");r.classList.add("menu-item"),r.setAttribute("tabindex",0),r.addEventListener("click",i.action),r.textContent=i.label,t.appendChild(r)}}}),n=t.popup;return n.addEventListener("click",function(e){e.target.closest(".menu-item")&&t.closePopup()}),n.addEventListener("keydown",function(e){if(38===e.keyCode){e.preventDefault();for(var t=document.activeElement.previousElementSibling;t&&"HR"===t.nodeName;)t=t.previousElementSibling;t&&t.classList.contains("menu-item")&&t.focus()}else if(40===e.keyCode){e.preventDefault();for(var n=document.activeElement.nextElementSibling;n&&"HR"===n.nodeName;)n=n.nextElementSibling;n&&n.classList.contains("menu-item")&&n.focus()}else 13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),document.activeElement.click())}),t};addEventListener("keydown",function(e){if(27===e.keyCode)if(c){e.preventDefault();var t=c;t.closePopup(),t.focus()}else e.target.closest(".simple-console")===l&&d.focus()}),m(function(){var e=[];if(b.length>0){for(var t=0;t<b.length;t++){!function(t,n){e.push({label:t,action:function(){d.value=t,d.focus(),d.setSelectionRange(d.value.length,d.value.length)}})}(b[t])}e.push({type:"divider"}),e.push({label:"Clear command history",action:L})}else e.push({label:"Command history empty",action:function(){}});return e});var f,h=function(){return f},v=function(e){var t=u.is_scrolled_to_bottom(),n=document.createElement("div");return n.className="entry",e instanceof Element?n.appendChild(e):n.innerText=n.textContent=e,u.appendChild(n),requestAnimationFrame(function(){t&&u.scroll_to_bottom()}),f=n,n},g=function(e){v(e),h().classList.add("error")};u.is_scrolled_to_bottom=function(){return u.scrollTop+u.clientHeight+1>=u.scrollHeight},u.scroll_to_bottom=function(){u.scrollTop=u.scrollHeight};var b=[],y=b.length,E=i+" command history",C=function(){try{localStorage[E]=JSON.stringify(b)}catch(e){}},L=function(){b=[],C()};!function(){try{b=JSON.parse(localStorage[E]),y=b.length}catch(e){}}(),d.addEventListener("keydown",function(e){if(13===e.keyCode){var t=d.value;if(""===t)return;d.value="",b[b.length-1]!==t&&b.push(t),y=b.length,C();var o=v(t);o.classList.add("input"),r(o),u.scroll_to_bottom(),n(t)}else 38===e.keyCode?(--y<0?(y=-1,d.value=""):d.value=b[y],d.setSelectionRange(d.value.length,d.value.length),e.preventDefault()):40===e.keyCode?(++y>=b.length?(y=b.length,d.value=""):d.value=b[y],d.setSelectionRange(d.value.length,d.value.length),e.preventDefault()):46===e.keyCode&&e.shiftKey&&(d.value===b[y]&&(b.splice(y,1),y=Math.max(0,y-1),d.value=b[y]||"",C()),e.preventDefault())}),this.element=l,this.input=d,this.addButton=function(e){var t=document.createElement("button");return s.appendChild(t),t.addEventListener("click",e),t},this.addPopupButton=p,this.addPopupMenuButton=m,this.handleUncaughtErrors=function(){window.onerror=g},this.log=v,this.logHTML=function(e){v(""),h().innerHTML=e},this.error=g,this.warn=function(e){v(e),h().classList.add("warning")},this.info=function(e){v(e),h().classList.add("info")},this.success=function(e){v(e),h().classList.add("success")},this.getLastEntry=h,this.clear=function(){u.innerHTML=""}};

